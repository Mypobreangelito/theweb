---
import { onMount } from "solid-js";

const {
  images = [],
  interval = 4000,
  autoplay = false,
  pauseOnHover = false,
  showDots = true,
  showArrows = true,
} = Astro.props;

let current = 0;
let timer;

function next() {
  current = (current + 1) % images.length;
}

function prev() {
  current = (current - 1 + images.length) % images.length;
}

onMount(() => {
  if (autoplay) {
    timer = setInterval(next, interval);
  }
});

function pause() {
  if (pauseOnHover && timer) clearInterval(timer);
}

function resume() {
  if (pauseOnHover && autoplay) {
    timer = setInterval(next, interval);
  }
}
---

<div
  class="relative w-full max-w-3xl mx-auto"
  onmouseenter={pause}
  onmouseleave={resume}
>
  <!-- Imagen actual -->
  <img
    src={images[current].src}
    alt={images[current].alt}
    class="w-full h-auto rounded-lg object-cover"
  />
  {images[current].caption && (
    <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-white p-2 text-sm">
      {images[current].caption}
    </div>
  )}

  <!-- Flechas -->
  {showArrows && (
    <>
      <button
        class="absolute top-1/2 left-2 -translate-y-1/2 bg-black/40 text-white px-2 py-1 rounded"
        aria-label="Anterior"
        onClick={prev}
      >
        ‹
      </button>
      <button
        class="absolute top-1/2 right-2 -translate-y-1/2 bg-black/40 text-white px-2 py-1 rounded"
        aria-label="Siguiente"
        onClick={next}
      >
        ›
      </button>
    </>
  )}

  <!-- Dots -->
  {showDots && (
    <div class="absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-2">
      {images.map((_, idx) => (
        <button
          class={`w-2 h-2 rounded-full ${
            idx === current ? "bg-white" : "bg-gray-400"
          }`}
          onClick={() => (current = idx)}
        />
      ))}
    </div>
  )}
</div>